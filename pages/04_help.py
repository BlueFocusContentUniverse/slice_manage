import streamlit as st

# 设置页面配置
st.set_page_config(
    page_title="帮助文档 - 视频解析处理系统",
    page_icon="❓",
    layout="wide",
    initial_sidebar_state="expanded"
)

# 侧边栏
st.sidebar.title("视频解析处理系统")
st.sidebar.info("帮助文档和使用指南")

# 主标题
st.title("帮助文档")

# 创建选项卡
tab1, tab2, tab3, tab4 = st.tabs(["系统概述", "使用指南", "常见问题", "联系我们"])

with tab1:
    st.header("系统概述")
    st.markdown("""
    视频解析处理系统是一个基于人工智能的视频内容分析工具，主要用于汽车或其他产品的视频素材处理。
    
    ### 系统特点
    
    - **自动解析**: 自动识别视频内容，分析人物动作、车辆特写、场景等信息
    - **智能切片**: 根据场景变化自动切分视频素材
    - **批量处理**: 支持同时处理多个视频文件，提高工作效率
    - **自定义模板**: 根据不同产品类型自定义解析维度
    - **知识库存储**: 将解析结果存入知识库，方便后续使用
    
    ### 系统架构
    
    - **前端**: 基于Streamlit构建的用户界面
    - **后端**: Celery任务队列和Redis存储
    - **处理引擎**: 视频处理和AI分析组件
    - **存储系统**: MinIO对象存储和知识库
    """)
    
    # 添加系统流程图
    st.subheader("系统流程")
    st.markdown("""
    ```
    +-------------+      +--------------+      +---------------+
    |             |      |              |      |               |
    | 上传视频文件 +----->+ 视频切片处理 +----->+ AI内容解析    |
    |             |      |              |      |               |
    +-------------+      +--------------+      +-------+-------+
                                                       |
                  +------------------+                  |
                  |                  |                  |
                  | 知识库存储       <------------------+
                  |                  |
                  +------------------+
    ```
    """)

with tab2:
    st.header("使用指南")
    
    st.subheader("1. 单视频处理")
    st.markdown("""
    在主页面上，您可以上传单个视频并处理：
    
    1. 输入知识库ID（必填项）
    2. 上传视频文件（支持mp4、avi、mov格式）
    3. 选择解析维度模板或自定义解析维度
    4. 输入品牌车型/产品名称，用于替换解析维度中的占位符
    5. 点击"开始处理"按钮
    6. 在右侧可以查看处理进度和视频预览
    7. 处理完成后，结果会显示在页面上并存入知识库
    """)
    
    st.subheader("2. 批量处理")
    st.markdown("""
    在批量处理页面上，您可以同时上传和处理多个视频：
    
    1. 输入知识库ID（必填项）
    2. 上传多个视频文件（可多选）
    3. 选择解析维度模板或自定义解析维度
    4. 输入品牌车型/产品名称
    5. 设置并发处理数（默认为3，最大为7）
    6. 点击"开始批量处理"按钮
    7. 在页面上可以查看批处理进度和每个任务的状态
    8. 可以随时取消未开始的任务
    """)
    
    st.subheader("3. 系统设置")
    st.markdown("""
    在设置页面，您可以配置系统的各项参数：
    
    1. 知识库配置：用户名、密码、数据集ID等
    2. MinIO配置：对象存储相关参数
    3. API配置：各种API密钥
    4. 视频处理配置：输入输出路径、切片参数等
    5. 分析配置：AI模型相关参数
    
    修改后点击"保存配置"按钮使配置生效。部分配置可能需要重启系统才能生效。
    """)
    
    st.subheader("4. 任务监控")
    st.markdown("""
    在监控页面，您可以查看系统运行状态和任务详情：
    
    1. 系统状态：待处理任务数、处理中任务数、已完成任务数
    2. 任务状态分布：各种状态的任务占比
    3. Worker状态：查看Celery Worker的运行情况
    4. 任务列表：查看所有任务的详细信息
    5. 任务详情：选择特定任务查看其详细信息和状态
    """)

with tab3:
    st.header("常见问题")
    
    # 使用列表展示常见问题
    faqs = [
        {
            "question": "如何获取知识库ID？",
            "answer": "知识库ID可以从内容宇宙知识库系统管理界面获取。登录后，在数据集管理页面选择或创建数据集，即可看到数据集ID。"
        },
        {
            "question": "系统支持哪些视频格式？",
            "answer": "目前系统支持MP4、AVI和MOV格式的视频文件。如需支持其他格式，请联系系统管理员。"
        },
        {
            "question": "视频处理失败怎么办？",
            "answer": "视频处理失败可能有多种原因：\n1. 视频文件损坏或格式不支持\n2. 系统资源不足\n3. 网络连接问题\n\n建议检查视频文件是否正常，尝试重新上传处理，或联系系统管理员查看日志。"
        },
        {
            "question": "如何自定义解析维度？",
            "answer": "在上传视频时，可以在\"自定义视频解析维度\"文本框中编辑解析维度。系统提供了几种预设模板，您也可以完全自定义解析维度，按行编写每个需要分析的角度，可以使用{车型}或{品牌}占位符，系统会自动替换为您输入的品牌车型。"
        },
        {
            "question": "批处理时如何控制并发数？",
            "answer": "在批量处理页面，上传文件后可以通过\"并发处理数\"滑块控制同时处理的视频数量。默认为3，最大值为7。根据系统资源情况合理设置并发数，避免系统过载。"
        },
        {
            "question": "处理结果存储在哪里？",
            "answer": "视频处理结果分为两部分：\n1. 切片后的视频片段存储在MinIO对象存储中\n2. 解析结果存储在知识库系统中，可以通过知识库ID在知识库系统中查看"
        },
        {
            "question": "系统处理速度受哪些因素影响？",
            "answer": "系统处理速度主要受以下因素影响：\n1. 视频文件大小和长度\n2. 服务器硬件资源（CPU、内存、GPU）\n3. 当前系统负载和并发任务数\n4. 网络带宽（上传和存储）\n5. AI分析模型的复杂度\n\n对于大型视频文件，建议适当降低并发数以获得更稳定的处理效果。"
        }
    ]
    
    # 展示FAQ
    for i, faq in enumerate(faqs):
        with st.expander(f"Q{i+1}: {faq['question']}"):
            st.markdown(faq['answer'])
    
    st.subheader("问题反馈")
    st.markdown("""
    如果您遇到上述未涵盖的问题，或者有任何建议，请通过以下方式联系我们：
    
    1. 在系统内提交问题报告
    2. 发送邮件至系统管理员
    3. 通过内部工单系统提交问题
    """)

with tab4:
    st.header("联系我们")
    
    st.markdown("""
    ### 系统开发团队
    
    视频解析处理系统由内容宇宙AI开发团队开发和维护。
    
    ### 联系方式
    
    - **邮箱**: jin.peng@bluefocus.com
    - **内部工单系统**: [AI技术支持](http://support.bluefocus.com)
    
    ### 寻求帮助
    
    如果您在使用过程中遇到任何问题，请随时联系我们。我们将在工作时间内尽快回复您的问题。
    
    ### 提交建议
    
    我们非常欢迎用户提供改进建议。如果您有任何关于系统功能或用户体验的建议，请通过上述联系方式告诉我们。
    """)

# 添加版本信息
st.markdown("---")
st.caption("系统版本: 1.0.0")
st.caption("最后更新: 2025-5-16")
st.caption("© 2023 内容宇宙studio AI技术平台. 保留所有权利。") 